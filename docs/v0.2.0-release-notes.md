# Sake Framework v0.2.0 - Core Routing

**Release Date**: 2026-01-28
**Commit**: 4b806b6
**Tag**: v0.2.0-routing

---

## ğŸ¯ Overview

Sake Framework v0.2.0 completes **Core Routing** functionality, achieving 100% parity with Gin's routing features. This release adds wildcard routes, additional HTTP methods, route groups, and comprehensive middleware support.

**Overall Progress**: 45% â†’ 54% (+9%)
**Core Routing Progress**: 60% â†’ 100% âœ…

---

## âœ¨ New Features

### 1. Wildcard Routes

Support for wildcard path segments that capture remaining path components:

```nv
// Serve static files
app.get("/static/*filepath", |ctx| {
    let path = ctx.param("filepath");  // "css/main.css"
    ctx.file(path);
});

// API proxy
app.any("/proxy/*path", |ctx| {
    let path = ctx.param("path");  // "api/v1/users/123"
    proxy_request(path);
});
```

**Features:**
- Wildcard must be last segment
- Captures one or more path segments
- Works with path parameters: `/users/:id/files/*filepath`

### 2. Additional HTTP Methods

```nv
// OPTIONS for CORS preflight
app.options("/api/*path", |ctx| {
    ctx.header("Access-Control-Allow-Methods", "GET, POST, PUT, DELETE");
    ctx.status(204);
});

// HEAD for resource checking
app.head("/files/:id", |ctx| {
    if (file_exists(id)) {
        ctx.status(200);
    } else {
        ctx.status(404);
    }
});

// ANY for universal handlers
app.any("/health", |ctx| {
    ctx.json({"status": "ok"});
});
```

### 3. RouterGroup

Organize routes with common prefixes and middleware:

```nv
// API versioning
let v1 = app.group("/api/v1");
v1.use(rate_limit_middleware);

v1.get("/users", |ctx| {
    ctx.json({"users": []});
});

v1.get("/posts", |ctx| {
    ctx.json({"posts": []});
});

// Nested groups
let admin = v1.group("/admin");
admin.use(auth_middleware);

admin.get("/settings", |ctx| {
    ctx.json({"settings": {}});
});
// Route: GET /api/v1/admin/settings
```

**Features:**
- Path prefix combination
- Middleware inheritance
- Unlimited nesting
- All HTTP method shortcuts

### 4. Route-Level Middleware

Apply middleware to specific routes:

```nv
// Public route
app.get("/", |ctx| {
    ctx.string("Welcome!");
});

// Protected route
app.get("/admin", |ctx| {
    ctx.string("Admin Panel");
}).use(auth_middleware).use(audit_middleware);

// CPU-intensive protected route
app.get("/report/:id", |ctx| {
    generate_report(ctx.param("id"));
}).use(auth_middleware).worker();
```

**Middleware Execution Order:**
1. Global middleware (`app.use()`)
2. Group middleware (`group.use()`)
3. Route middleware (`route.use()`)
4. Route handler

---

## ğŸ“¦ What's Included

### Files Changed
- `src/router.nv` - Wildcard matching, RouterGroup, route middleware
- `src/engine.nv` - OPTIONS, HEAD, ANY methods, group creation
- `tests/test_routing.nv` - 50+ comprehensive routing tests
- `docs/gin-parity-checklist.md` - Progress tracking

### Statistics
- **+1,260 lines** of code and tests
- **50+ test cases** covering all routing features
- **100% Core Routing** completion

---

## ğŸ“ Examples

### Complete API with Groups

```nv
use sake.Engine;

fn main() throws {
    let app = Engine.default();

    // Global middleware
    app.use(logger_middleware);
    app.use(recovery_middleware);

    // Public routes
    app.get("/", |ctx| {
        ctx.string("Welcome to Sake API!");
    });

    // API v1
    let v1 = app.group("/api/v1");
    v1.use(cors_middleware);

    v1.get("/health", |ctx| {
        ctx.json({"status": "healthy"});
    });

    // Protected admin routes
    let admin = v1.group("/admin");
    admin.use(auth_middleware);

    admin.get("/users", |ctx| {
        ctx.json({"users": get_all_users()});
    });

    admin.delete("/users/:id", |ctx| {
        delete_user(ctx.param("id"));
        ctx.status(204);
    }).use(audit_middleware);

    // Static file serving
    app.get("/static/*filepath", |ctx| {
        serve_static_file(ctx.param("filepath"));
    });

    try app.run(":8080");
}
```

---

## ğŸ§ª Testing

Run the comprehensive routing test suite:

```bash
navi test tests/test_routing.nv
```

**Test Coverage:**
- âœ… Exact path matching
- âœ… Path parameters (`:param`)
- âœ… Wildcard routes (`*filepath`)
- âœ… Router groups and nesting
- âœ… Group middleware inheritance
- âœ… Route-level middleware
- âœ… All HTTP methods
- âœ… Worker mode configuration
- âœ… Edge cases and priority

---

## ğŸ“š API Reference

### Engine Methods

```nv
// HTTP methods
app.get(path, handler): RouteBuilder
app.post(path, handler): RouteBuilder
app.put(path, handler): RouteBuilder
app.delete(path, handler): RouteBuilder
app.patch(path, handler): RouteBuilder
app.options(path, handler): RouteBuilder
app.head(path, handler): RouteBuilder
app.any(path, handler)  // No builder, registers all methods

// Route organization
app.group(prefix): RouterGroup
app.use(middleware)
```

### RouterGroup Methods

```nv
// HTTP methods (same as Engine)
group.get(path, handler): RouteBuilder
group.post(path, handler): RouteBuilder
// ... etc

// Group management
group.group(prefix): RouterGroup  // Create nested group
group.use(middleware)              // Add group middleware
```

### RouteBuilder Methods

```nv
builder.worker(): RouteBuilder     // Enable WorkerPool
builder.use(middleware): RouteBuilder  // Add route middleware
```

---

## ğŸ”„ Migration from v0.1.0

No breaking changes! All v0.1.0 code continues to work.

**New capabilities:**
```nv
// Before: Flat routing only
app.get("/api/v1/users", handler);
app.get("/api/v1/posts", handler);
app.get("/api/v2/users", handler);

// After: Organized with groups
let v1 = app.group("/api/v1");
v1.get("/users", handler);
v1.get("/posts", handler);

let v2 = app.group("/api/v2");
v2.get("/users", handler);
```

---

## ğŸ¯ Next Steps: v0.3.0 - Context Enhancements

**Planned Features:**
1. `default_query()` helper
2. Form/URI/header binding
3. XML/YAML response methods
4. Type-safe getter methods
5. Comprehensive context tests

**Target**: +10% overall progress (54% â†’ 64%)

---

## ğŸ™ Acknowledgments

- Gin Framework - API design inspiration
- Navi Language - Making Sake possible
- Community - Testing and feedback

---

**Enjoy building with Sake! ğŸ¶**

For questions or issues: https://github.com/YOUR_REPO/sake/issues
